# Order Service

Демонстрационный микросервис на Go, который получает данные заказов из Kafka, сохраняет их в PostgreSQL, кэширует в памяти и предоставляет HTTP API и веб-интерфейс для отображения информации по заказу.

## Описание

Сервис выполняет следующие функции:

- Подключается к Kafka и подписывается на тему с сообщениями о заказах.
- Обрабатывает входящие сообщения: парсит JSON, сохраняет данные в базу PostgreSQL.
- Кэширует последние полученные данные заказов в памяти для быстрого доступа.
- При старте сервиса загружает актуальные данные из БД в кеш.
- Предоставляет HTTP API для получения информации о заказе по `order_uid` в формате JSON.
- Реализует простую HTML/JS страницу, где можно ввести ID заказа и получить данные через API.
- Обрабатывает некорректные сообщения (игнорирование и логирование).
- Используются транзакции в PostgreSQL и подтверждение сообщений в Kafka для надёжности.

## Технологии

- Язык программирования: Go
- База данных: PostgreSQL
- Очередь сообщений: Kafka
- Веб-сервер: HTTP сервер на Go (с использованием `gin`)
- Кэширование: реализован потокобезопасный (inmemory) кэш
- Интерфейс: простая HTML+JavaScript страница

## Быстрый старт

### 1. Запуск проекта через Docker Compose

В проекте предусмотрен `docker-compose.yml`, который запускает:

- PostgreSQL с настроенной базой данных и пользователем
- Kafka и Zookeeper
- Ваш сервис (приложение на Go)

Запустите команду:
```
docker compose up
```

Это автоматически соберёт и запустит все необходимые контейнеры.

### 2. Запуск сервиса

После старта сервис автоматически:

- Подключится к Kafka и будет слушать новые сообщения
- Сохранять валидные сообщения в базу данных
- Кэшировать данные в памяти
- Запустит HTTP сервер на порту `8081` (по умолчанию)

### 3. Использование HTTP API

Чтобы получить информацию о заказе по ID, сделайте GET-запрос:
```
GET http://localhost:8081/order/<order_uid>
```

В ответ сервис вернёт JSON с данными заказа или ошибку, если заказ не найден.

### 4. Веб-интерфейс

Откройте в браузере страницу:

```
http://localhost:8081/order
```
Введите `order_uid` в поле ввода и нажмите кнопку, чтобы получить и увидеть данные заказа. order_uid можно взять из логов сервиса.

Также реализован скрипт, который запускается в докере и отправляет сообщения в kafke раз в секунду, для проверки.
